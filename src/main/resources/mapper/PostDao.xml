<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.nuc.a4q.dao.PostDao">
 	<insert id="insertPost" parameterType="Post">
 		insert into
 		tb_post(course_id,user_id,best_answer_id,post_title,post_content,priority,enable_view,create_time,last_edit_time)
 		values(#{course.courseId},#{deployUser.userId},#{bestAnswer.floorId},#{postTitle},#{postContent},#{priority},#{enableView},#{createTime},#{lastEditTime})
 	</insert>
 	
 	<update id="updatePost" parameterType="Post">
 		update tb_post
		<set>
			<if test="course!=null">course_id=#{course.courseId},</if>
			<if test="deployUser!=null">user_id=#{deployUser.userId},</if>
			<if test="bestAnswer!=null">best_answer_id=#{bestAnswer.floorId},</if>
			<if test="postTitle!=null">post_title=#{postTitle},</if>
			<if test="postContent!=null">post_content=#{postContent},</if>
			<if test="priority!=null">priority=#{priority},</if>
			<if test="enableView!=null">enable_view=#{enableView},</if>
			<if test="createTime!=null">create_time=#{createTime},</if>
			<if test="lastEditTime!=null">last_edit_time=#{lastEditTime}</if>
		</set>
		where post_id=#{postId}
 	</update>
 	
 	<delete id="deletePost" parameterType="Post">
 		delete from tb_post where post_id=#{postId}
 	</delete>
 	
 	<select id="queryPostList" resultMap="postMap">
 		select 
 		p.post_id,c.course_id,c.course_name,per.user_id,per.user_name,f.floor_id,post_title,post_content,p.priority,enable_view,p.create_time,p.last_edit_time
 		from 
 		tb_post p left join tb_floor f on p.best_answer_id=f.floor_id,tb_person_info per,tb_course c
 		<where>
 			<if test="postContent!=null">and post_content like CONCAT("%",#{postContent},"%")</if>
 			<if test="course!=null">and c.course_id=p.course_id</if>
 			<if test="deployUser!=null">and per.user_id=p.user_id</if>
 		</where>
 	</select>
 	
 	<resultMap type="Post" id="postMap">
 		<id column="post_id" property="postId"/>
 		<result column="post_title" property="postTitle"/>
 		<result column="post_content" property="postContent"/>
 		<result column="priority" property="priority"/>
 		<result column="enable_view" property="enableView"/>
 		<result column="create_time" property="createTime"/>
 		<result column="last_edit_time" property="lastEditTime"/>
 		<association property="course" javaType="Course">
 			<id column="course_id" property="courseId"/>
 			<result column="course_name" property="courseName"/>
 		</association>
 		<association property="deployUser" javaType="PersonInfo">
 			<id column="user_id" property="userId"/>
 			<result column="user_name" property="userName"/>
 		</association>
 		<association property="bestAnswer" javaType="Floor">
 			<id column="floor_id" property="floorId"/>
 		</association>
 	</resultMap>

 </mapper>
 